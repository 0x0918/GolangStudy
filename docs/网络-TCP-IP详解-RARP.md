# TCP-IP 详解：RARP 逆地址解析协议

具有本地磁盘的系统引导时，一般是从磁盘上的配置文件中读取 IP 地址。但是无盘系统，如 X 终端或无盘工作站，则需要采用其他方法来获得 IP 地址。

无盘系统的 RARP 实现过程是从接口卡上读取唯一的硬件地址，然后发送一份 RARP 请求（一帧在网络上的广播的数据），请求某个主机响应该无盘系统的 IP 地址。

## RARP 的分组格式

RARP 分组的格式与 ARP 分组基本一致。

对应于 ARP，RARP 请求以广播方式传送，而 RARP 应答一般是单播（unicast）传送的。

![ARP 格式](https://cnymw.github.io/GolangStudy/docs/img/网络-TCP-IP详解-ARP-格式.png)

- 6位以太网目的地址：目的地址为全 1 的特殊地址是广播地址，电缆上的所有以太网接口都要接受广播的数据帧。
  
- 6位以太网源地址：源地址的以太网地址。
  
- 2位帧类型：表示后面数据的类型，对于 RARP 请求或应答来说，该字段值为 0x0835。
  
- 2位硬件类型：硬件地址的类型。它的值为 1 即表示以太网地址。
  
- 2位协议类型：表示要映射的协议地址类型。它的值为 0x0800 即表示 IP 地址。
  
- 1位硬件地址长度：表示硬件地址长度，以字节为单位。对于 RARP 来说，值为6。
  
- 1位协议地址长度：表示协议地址长度，以字节为单位。对于 RARP 来说，值为4。
  
- 2位操作类型：指定 4 种操作类型：1.ARP 请求 2.ARP 应答 3. RARP 请求 4.RARP 请求
  
- 6位发送端的以太网地址：发送端的硬件地址。
  
- 4位发送端 IP 地址：发送端的协议地址。
  
- 6位目的以太网地址：目的端的硬件地址。
  
- 4位目的端 IP 地址：目的端的协议地址。

## 工作过程

RARP 的工作过程如下：

1. 网络上的每台设备都会有一个独一的硬件地址，通常是由设备厂商分配的 MAC 地址。主机从网卡上读取 MAC 地址，然后在网络上发送一个 RARP 请求的广播数据报，请求 RARP 服务器回复该主机的 IP 地址。
   
2. RARP 服务器收到了 RARP 请求数据报，为其分配 IP 地址，并将 RARP 回应发送给主机。
   
3. 主机收到 RARP 回应后，就使用得到的 IP 地址进行通讯。

# 思维导图

![思维导图](https://cnymw.github.io/GolangStudy/docs/img/网络-TCP-IP详解-RARP-思维导图.png)
