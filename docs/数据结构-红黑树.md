# 红黑树的性质

## 基本概念

红黑树是一种二叉搜索树，每个节点上增加一个存储位表示节点的颜色，可以是 RED 或 BLACK。

通过对任何一条从根到叶子的路径上各个结点着色方式的限制，红黑树确保没有一条路径会比其他路径长出两倍，因而是接近平衡的。

## 性质

红黑树有如下性质：

1. 每个结点是红的，或是黑色的
2. 根结点是黑色的
3. 每个叶结点是黑色的
4. 如果一个结点是红色的，那它的两个儿子都是黑色的
5. 对每个结点，从该结点到其子孙结点的所有路径上包含相同数目的黑结点

## 黑高

从某个节点 x 出发（不包含该节点）到达一个叶节点的任意一条简单路径上的黑色节点个数称为该节点的黑高，记为 bh(x)。

根据性质 5，黑高的概念是明确定义的，因为从该节点出发的所有下降到其叶节点的简单路径的黑节点个数都相同。于是定义红黑树的黑高为其根节点的黑高。

## 红黑树引理

### 一棵有 n 个内部节点的红黑树的高度至多为 2lg(n+1)

证明：

设 h 为树的高度，根据性质 4，从根到叶节点（不包括根节点）的任何一条简单路径上都至少有一半的节点为黑色。

因此，根的黑高至少为 h/2，于是有 n>=2^(h/2)-1，于是有 h<=2lg(n+1)

## 实现

### 旋转

指针结构的修改是通过旋转来完成的，这是一种能保持二叉搜索树性质的搜索树局部操作。旋转分为两种：

1. 左旋
2. 右旋

![旋转示意图](https://gitee.com/GolangStudy_1/AliGolangStudy/raw/master/docs/img/数据结构-红黑树/数据结构-红黑树-旋转示意图.png)

树的旋转操作是平衡树为了将树重新置为平衡的基本操作，例如红黑树，AVL 树中都有旋转的操作。

旋转的实现核心在于指针修改的顺序问题，需要注意旋转过程中所有节点的子节点以及父节点不要漏操作漏，不要置为 nil,否则会存在树从中断掉的意外。

![旋转伪代码](https://gitee.com/GolangStudy_1/AliGolangStudy/raw/master/docs/img/数据结构-红黑树/数据结构-红黑树-旋转伪代码.png)

下面给出一个左旋操作修改二叉搜索树的例子:

![左旋例子](https://gitee.com/GolangStudy_1/AliGolangStudy/raw/master/docs/img/数据结构-红黑树/数据结构-红黑树-左旋例子.png)


## 参考资料

- [30张图带你彻底理解红黑树](https://www.jianshu.com/p/e136ec79235c)
